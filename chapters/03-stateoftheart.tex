
\chapter{State of the art} % XXX: EXTREMELY_NASTY: i might've misunderstood the point of this section, should _academic_ papers be reviewed here? anyways,
% this section will need some elbow grease to "fit in" into the definition of the "state of the art"

\section{Whole system emulators}

\subsection{Renode Framework}

The Renode Framework is Antmicroâ€™s open-source, permissively licensed (MIT), embedded device simulation framework. Being mostly written in C\#, the framework provides an organized,
easily expandable codebase, rich in object-oriented principles. It can be compiled using both mono and .NET build systems for all major operating systems.
The framework supports a wide range of CPU architectures, including, among others, \textit{ARMv7}, \textit{ARMv8}, and \textit{RISC-V}.
Additionally, Renode offers comprehensive whole-system emulation, allowing for the simulation of complex peripherals and interconnections. This capability enables developers to
create and test realistic embedded system environments, including I/O devices, sensors, and communication interfaces. The platform description files and execution scripts
use simple and easily modificable syntax, allowing for rapid iteration, efficient testing, and seamless integration with various development workflows.

One of the outstanding qualities of the Renode framework is its advanced debugging, logging, and execution tracing systems, such as:
\begin{itemize}
	\item \textbf{Execution tracer:} this subsystem allows for monitoring and saving the traces of all major CPU operations, including execution tracing, memory access logging and
		performed I/O operations.
	\item \textbf{Execution metrics:} a module that allows to measure the quantitative data related to the simulation, including number of accesses to peripherals, number of exceptions and
		the number of executed instructions (including counting of specific opcodes).
	\item \textbf{Execution profiler:} a call stack analysis tool intended for debugging and inspecting the guest virtual machine software.
	\item \textbf{Python hooks:} the framework utilizes a built-in Python API to provide an easy entry point to automate testing, extend the simulator's functionalities, and integrate
		seamlessly with other tools and workflows.
\end{itemize}

\noindent Due to its advanced debugging capabilities, the Renode framework was selected as the emulation framework for this work.

\subsection{QEMU}

QEMU, also called \textit{Quick Emulator} \cite{qemuoriginal}, is a whole-system emulation framework, with KVM support. Originally developed by Fabrice Bellard \cite{qemufabrice} and released
under GNU General Public License v2. It is written entirely in the C programming language, and can compiled for all major operating systems.

It supports most popular CPU architectures and is capable of whole system emulation. However, unlike Renode, the platforms in QEMU are defined in \textit{header files}, which means
that changes to the platform configuration are relatively slow and require recompilation of the project. Another similarity to Renode is that QEMU also provides a set of debugging
and analysis tools. However, instead of using Python as a scripting engine, QEMU implements its own fully custom plugin system, which also requires the user to recompile the
application to apply changes. Its main distinguishing factor is built-in support for userspace and KVM emulation, allowing for very efficient emulation if the simulated software is
compiled for the same architecture and/or operating system. In the context of this thesis, QEMU ships with a \textit{Cache Modelling TCG Plugin} \cite{tcgcachemodelling}.

% XXX: i don't like this, this is supposed to be an overview of the state of the art... and I'm showing off 2 simulators that are somewhat "popular",
% and putting the rest into a "catch-all bin". In the ideal world I'd not do that, but to be frank, I don't really know what I should describe here, as I'm not
% that familiar with them...
\subsection{Other notable simulators}

\begin{itemize} % TODO: add more info here
	\item \textbf{Intel Simics:} is a full-system simulator developed by Wind River, a subsidiary of Intel. Simics supports a wide range of CPU architectures and peripheral models.
		It is released under a proprietary, closed-source license.
	\item \textbf{gem5:} event driven full-system emulator, mainly used in academia and advanced research institutions. Developed by universities, companies and the community, maintained by the
		\textit{Project management committee} \cite{gem5governance}. % TODO: gem5 is mainly used in the academia, it is pretty advanced, but hard to use for a "newcomer", I have no idea how to put this nicely
\end{itemize}

\section{Cache simulators}

\subsection{gem5}

The \textit{gem5} project is a highly flexible, modular platform for computer system architecture research and development, that includes advanced cache modeling features \cite{gem5cachesupport}.
It has been previously used in a number of academic papers discussing the topic of CPU caches \cite{gem5cachecite1, gem5cachecite2, gem5cachecite3}.

This simulator supports a wide range of cache architectures and configurations, offering high flexibility, essential for research and academic institutions \cite{gem5}.
It operates with cycle-level simulation accuracy, allowing for modeling and measuring the timing performance characteristics of cache behavior. This potentially provides a higher level of accuracy
compared to behavioral or functional simulators \cite{gem5accuracy}. \textit{gem5} enables the simulation of complex memory hierarchies, including multi-level caches, which are commonly
used in modern computer architectures \cite{gem5multilevel, cachesimsurv}.

Despite its strengths, the high level of detail and flexibility in can make it complex and difficult to set up. The documentation is extensive, but its high level of detail can be overwhelming,
making it challenging to navigate effectively \cite{gem5hell}. The complex simulation model also requires significant computational resources for simulating complex, real world payloads
\cite{gem5, cachesimsurv}. As an open-source and mainly community and academia backed project, \textit{gem5} relies on community updates and maintenance, which can lead to periods where certain
features may be underdeveloped or not fully supported \cite{gem5hell, gem5maintainers}. While the project uses a modular approach for its modules and hardware models, the project complex codebase,
unstable APIs, frequent functionality breaking changes \cite{gem5hell} result in the fact that \textit{gem5} is very hard to integrate with external tooling.

\subsection{QEMU TCG Cache Modeling plugin} \label{sec:qemu_cache}

The TCG Cache Modeling plugin is a plugin for the QEMU emulator, created as a part of Google Summer of Code \cite{qemucachegsoc}. It supports a variety of cache configuration parameters, such as
cache and block size, eviction policies and optional L2 support \cite{tcgcachemodelling}.

A significant advantage of the plugin is its ease of use in the existing QEMU workflows, since it doesn't require any additional software to be introduced into the development processes.
However, such integration makes it nearly impossible to integrate this cache analysis tool with other simulators. There is no functionality to save the trace files, and process them off-line,
instead, the entirety of the cache model simulation happens entirely within the constraints of the TCG plugin system \cite{qemutcgplugindocs}, thus begin reliant on the QEMU for simulating the
payloads. For users looking for modular cache simulation tools that can be adapted to various other environments, this could pose a significant constraint.

\vspace{10px}
\noindent Efforts have also been made to incorporate cache modeling as a core feature of the QEMU simulator \cite{qemucacheattempt}, but these enhancements have not been merged, and the
source code has not been made publicly available.

\subsection{dineroIV}

DineroIV is a cache simulator for memory reference traces, created by the researchers from \textit{University of Wisconsin, Computer Sciences} \cite{dinero}. 
The cache model supports a variety of configuration parameters, such as overall cache size, block size, eviction methods, and others. These parameters are used to define the structure of
single and multi-level caches. DineroIV is purely a cache simulator, with no system emulation backend - it can be only used to emulate the cache from the memory reference traces.
It has been last updated in 1999 and is not available under open source license.

\section{pycachesim}

Pycahesim is a single-core cache hierarchy simulator with Python API and C backend. It has been developed and released by Regionales Rechenzentrum Erlangen, Hochleistungsrechner (RRZE-HPC)
under a AGPL-3.0 license \cite{pycachesim}. The Python API is straightforward and can be easily integrated into external projects. Since the backend is written in a compiled language, it is
relatively fast. The simulator supports complex, multilevel cache configurations, including exclusive and victim caches. % TODO: relative to what? 
However, pycahesim does not support the differentiation of instruction and data caches, which can limit its utility in more complex simulation scenarios. Additionally, the AGPL
license imposes significant restrictions on the commercial use of the project, resulting in little to no industry adoption. Due to this fact, the simulator remains mostly supported
by academic institutions, resulting in very infrequent updates\footnote{As of June 2024, the last update was released over two years ago.}.

\vspace{10px}
\noindent Efforts have been made to integrate QEMU and pycachesim \cite{pycachesimqemu}.

\subsection{Other notable simulators}
% TODO: move items from the list to the sections, explain every one briefly, put some citations, and it shoooould be goooood
\begin{itemize}
	\item \textbf{DynamoRIO, drcachesim:} hard to extract the cache only
	\item \textbf{Cachegrind:} only supports one level of cache
	\item \textbf{libCacheSim:}
	\item \textbf{SMPcache:} closed source, windows + gui only
	\item \textbf{CMPsim:} academically published, source code not available
	\item \textbf{CASPER:} academically published, source code not available
\end{itemize}
